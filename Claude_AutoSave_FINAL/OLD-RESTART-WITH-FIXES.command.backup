#!/bin/bash

# ============================================
# RESTART SMART SAVE WITH ALL FIXES
# ============================================

echo "ğŸ”§ Restarting Smart Save with all fixes applied..."

# Kill existing processes
pkill -f "claude-server-v5.js"
pkill -f "auto-memory-bridge.js"
pkill -f "menubar.py"

sleep 2

echo "âœ… Fixes Applied:"
echo "  â€¢ Word count now only counts conversation content"
echo "  â€¢ Input sanitization prevents security issues"
echo "  â€¢ Memory cleanup prevents leaks (100 file cache limit)"
echo "  â€¢ Packages updated to latest versions"
echo "  â€¢ Removed unused exec imports"
echo "  â€¢ Path always relative to project folder"
echo "  â€¢ Added retry logic for failed operations"

echo ""
echo "ğŸ“ The updated word count will show accurate numbers after restart"
echo "ğŸ”’ File names are now sanitized for security"
echo "ğŸ§¹ Memory will be cleaned every 30 minutes"
echo ""

# Restart using the main launcher
cd "$(dirname "$0")"
./START-WITH-MEMORY.command
